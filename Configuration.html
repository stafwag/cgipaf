<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>CGIpaf configuration</title>
</head>
<body bgcolor="#ffffff" text="#000000" link="#0000ff" alink="#ff0000" vlink="#2f009f">
<h1>CGIpaf 1.3.0pre2 Configuration</h1>
<h1>Content</h1>
<ul>
<li><a href="#syntax">Syntax</a></li>
<li><a href="#sections">Sections</a></li>
<li><a href="#directives">Directives</a>
<ul>
<li><a href="#syslog">syslog</a></li>
<li><a href="#loglevel">loglevel</a></li>
<li><a href="#pam_service">pam_service</a></li>
<li><a href="#document_root">document_root</a></li>
<li><a href="#login_document">login_document</a></li>
<li><a href="#error_loginname">error_loginname</a></li>
<li><a href="#error_access">error_access</a></li>
<li><a href="#error_invalid">error_invalid</a></li>
<li><a href="#error_newpassword">error_newpassword</a></li>
<li><a href="#error_match">error_match</a></li>
<li><a href="#error_unchanged">error_unchanged</a></li>
<li><a href="#error_tooshort">error_tooshort</a></li>
<li><a href="#error_torlong">error_toolong</a></li>
<li><a href="#error_locked">error_locked</a></li>
<li><a href="#error_forwardto">error_forwardto</a></li>
<li><a href="#error_invalidforwardto">error_invalidforwardto</a></li>
<li><a href="#msg_success">msg_success</a></li>
<li><a href="#msg_changed">msg_changed</a></li>
<li><a href="#msgmsg_updated">msg_updated</a></li>
<li><a href="#error_read">error_readname</a></li>
<li><a href="#error_readforward">error_readforward</a></li>
<li><a href="#error_readkeepmsg">error_readkeepmsg</a></li>
<li><a href="#error_readautoreply">error_readautoreply</a></li>
<li><a href="#error_autoreply_msg">error_autoreply_msg</a></li>
<li><a href="#error_cookie">error_cookie</a></li>
<li><a href="#error_cookietimeout">error_cookietimeout</a></li>
<li><a href="#error_accessdb">error_accessdb</a></li>
<li><a href="#error_cracklib">error_cracklib</a></li>
<li><a href="#error_mailcfgscript">error_mailcfgscript</a></li>
<li><a href="#error_pam">error_pam</a></li>
<li><a href="#error_illegalword">error_illegalword</a></li>
<li><a href="#min_uid">min_uid</a></li>
<li><a href="#max_uid">max_uid</a></li>
<li><a href="#min_length">min_length</a></li>
<li><a href="#max_length">max_length</a></li>
<li><a href="#accessdb">accessdb</a></li>
<li><a href="#cracklib">cracklib</a></li>
<li><a href="#cracklib">cracklib_dictpath</a></li>
<li><a href="#vmail_support">vmail_support</a></li>
<li><a href="#passwd_location">passwd_location</a></li>
<li><a href="#shadow_location">shadow_location</a></li>
<li><a href="#illegal_words">illegal_words</a></li>
<li><a href="#set_pam_change_expired_authtok">set_PAM_CHANGE_EXPIRED_AUTHTOK</a>This directive is absolete, and will be removed...</li>
<li><a href="#max_invalid">max_invalid</a></li>
<li><a href="#invalid_timeout">invalid_timeout</a></li>
<li><a href="#sendmail">sendmail</a></li>
<li><a href="#domain">domain</a></li>
<li><a href="#use_statefile">use_statefile</a></li>
<li><a href="#run_success">run_success</a></li>
<li><a href="#run_locked">run_locked</a></li>
<li><a href="#run_before_mailcfg">run_before_mailcfg</a></li>
<li><a href="#run_after_mailcfg">run_after_mailcfg</a></li>
<li><a href="#run_mailcfg">run_mailcfg</a></li>
<li><a href="#cookie_timeout">cookie_timeout</a></li>
<li><a href="#mailcfg_document">mailcfg_document</a></li>
<li><a href="#error_deldotforward">error_deldotforward</a></li>
<li><a href="#error_deldotprocmailrc">error_deldotprocmailrc</a></li>
<li><a href="#error_openvacations">error_openvacations</a></li>
<li><a href="#error_updateprocmailrc">error_updateprocmailrc</a></li>
<li><a href="#aclorder">AclOrder</a></li>
<li><a href="#allowusers">AllowUsers</a></li>
<li><a href="#denyusers">DenyUsers</a></li>
<li><a href="#allowgroups">AllowGroups</a></li>
<li><a href="#denygroups">DenyGroups</a></li>
</ul>
</li>
<li><a href="#variables">Variables</a></li>
<li><a href="#redirect">Redirect</a></li>
<li><a href="#htmlfile">HTML files</a></li>
<li><a href="#command">run_success and run_locked scripts</a></li>
<li><a href="#acl">Access Control List</a>
  <ul><li><a href="#aclexamples">Examples</a></li></ul></li>
</ul>
<h1><a name="syntax">Syntax</a></h1>
<p>    
  The configuration file (cgipaf.conf) contains one directive per line. 
  The directive names are case insensitive, the values are case sensitive.
  Everything after a hash ( # ) is ignored. Empty lines and whitespaces are 
  also ignored.
    
  If a directive appears more than ones the last one is used. 
    
  Sections are grouped between &lt;section_name&gt; ...
&lt;/section_name&gt;, the
  section names are like the directive names case insensitive.
</p> 
<h1><a name="sections">Sections</a></h1>
<p>
  The configuration file has three sections "global", "passwd" and "mailcfg". 
  The directives that don't belong to a section are global. Global directives 
  apply to all sections unless they're overwritten in the sections.<BR>
    
  The "passwd" section is used by passwd.cgi, viewmailcfg.cgi and mailcfg.cgi 
  use the "mailcfg" section.
</p>    
<h1><a name="directives">Directives</a></h1>
<p>    
 The following parameters control cgipaf features and configuration. If a 
 option is not specified or invalid the default builtin messages are used.
</p>
<h2><a name="syslog">syslog</a></h2>
<p><strong>Syntax:</strong> syslog <em>on|off</em><br>
<strong>Default:</strong> on<br>
<strong>Context:</strong>  global, &lt;passwd&gt;, &lt;mailcfg&gt;<br>
</p>
<p>enable syslog messages</p>
<p>all the authentication events are logged with LOG_AUTHPRIV facility, other events are logged with the LOG_USER facility</p>
<h2><a name="loglevel">loglevel</a></h2>
<p><strong>Syntax:</strong> loglevel <em>number</em><br>
<strong>Default:</strong> 6<br>
<strong>Context:</strong>  global, &lt;passwd&gt;, &lt;mailcfg&gt;<br>
</p>
<p>set the syslog level, messages of a higher significance will be reported as well.<BR>
e.g. if loglevel is set to 1 (LOG_ALERT) messages with loglevel 0 (LOG_EMERG) are also reported.
</p>
<table>
<tr><td><b>0</b></td><td>LOG_EMERG</td><td> system is unusable</td></tr>
<tr><td><b>1</b></td><td>LOG_ALERT</td><td> action must be taken immediately</td></tr>
<tr><td><b>2</b></td><td>LOG_CRIT</td><td> critical conditions</td></tr>
<tr><td><b>3</b></td><td>LOG_ERR</td><td> error conditions</td></tr>
<tr><td><b>4</b></td><td>LOG_WARNING</td><td> warning conditions</td></tr>
<tr><td><b>5</b></td><td>LOG_NOTICE</td><td> normal, but significant, condition</td></tr>
<tr><td><b>6</b></td><td>LOG_INFO</td><td> informational message</td></tr>
<tr><td><b>7</b></td><td>LOG_DEBUG</td><td> debug-level message</td></tr>
</table>
<h2><a name="pam_service">pam_service</a></h2>
<p><strong>Syntax:</strong> pam_service <em>pam service name</em><br>
<strong>Default:</strong> passwd<br>
<strong>Context:</strong> global, &lt;passwd&gt;, &lt;mailcfg&gt;<br>
<p>
Set the pam service name, if not set "passwd" is used. The passwd pam service
( /etc/pam.d/passwd ) usually doesn't have an entry for user authentication, 
therefor /etc/pam.d/other has to have a line auth set to pam_unix.so.
</p>
<pre><code><tt>
	auth     required       pam_unix.so
	account  required       pam_unix.so
</tt></code></pre>
<p>If you don't like this for security reason etc, you can set the pam_service directive to "cgipaf" and create the file /etc/pam.d/cgipaf that looks like this</p>
<pre><code><tt>
	auth     required       pam_unix.so
	account  required       pam_unix.so
        password required       pam_unix.so md5
</tt></code></pre>
<h2><a name="document_root">document_root</a></h2>
<p><strong>Syntax:</strong> document_root <em>path</em><br>
<strong>Default:</strong> not set<br>
<strong>Context:</strong>  global, &lt;passwd&gt;, &lt;mailcfg&gt;<br>
</p>
<p>location of the custom html message files</p>
<h2><a name="login_document">login_document</a></h2>
<p><strong>Syntax:</strong> login_document <em>filename</em> <b>OR</b>
 login_document Redirect <em>location</em><br>
<strong>Default:</strong> "error reading data please contact the
webmaster\n"<br>
<strong>Context:</strong> &lt;passwd&gt;, &lt;mailcfg&gt;
<p>  
    if the program is executed without parameters this message is displayed
</p>
<h2><a name="error_loginname">error_loginname</a></h2>
<strong>Syntax:</strong> error_loginname <em>filename</em> <b>OR</b>
error_loginname  Redirect   <em>location</em><br>
<strong>Default:</strong> "Can't read loginname\n"<br>
<strong>Context:</strong> &lt;passwd&gt;, &lt;mailcfg&gt;
<p>       
    The user forgot to type his loginname.
</p>
<h2><a name="error_access">error_access</a></h2>
<strong>Syntax:</strong> error_access <em>filename</em> <b>OR</b>
error_access  Redirect   <em>location</em><BR>
<strong>Default:</strong>"Access denied...\n"<BR>
<strong>Context:</strong> &lt;passwd&gt;, &lt;mailcfg&gt;
<p>    
    The user try to logon as root or the user's uid isn't between 
    <a href="#min_uid">min_uid</a> & <a href="#max_uid">max_uid</a>.
</p>
<h2><a name="error_invalid">error_invalid</a></h2>
<strong>Syntax:</strong> error_invalid <em>filename</em> <b>OR</b>
error_invalid Redirect  <em>location</em><BR>
<strong>Default:</strong> "Invalid password or username.\n"<BR>
<strong>Context:</strong>  &lt;passwd&gt;, &lt;mailcfg&gt;
<p>
    The password is incorrect or the user doesn't exists
</p>
<h2><a name="error_newpassword">error_newpassword</a></h2>
<strong>Syntax:</strong> error_newpasswd <em>filename</em> <b>OR</b>
error_newpassord  Redirect  <em>location</em><br>
<strong>Default:</strong> "Can't read new password\n"<BR>
<strong>Context:</strong> &lt;passwd&gt;
<p>       
    can't read new password
</p>
<h2><a name="error_match">error_match</a></h2>
<strong>Syntax:</strong>   error_match  <em>filename</em> <b>OR</b>
error_match    Redirect <em>location</em><BR>
<strong>Default:</strong> "They don't match\n"<BR>
<strong>Context:</strong>  &lt;passwd&gt;
<p>    
    The new passwords doesn't match
</p>       
<h2><a name="error_unchanged">error_unchanged</a></h2>
<strong>Syntax:</strong>   error_unchanged  <em>filename</em> <b>OR</b>
error_unchanged    Redirect <em>location</em><BR>
<strong>Default:</strong> "Password Unchanged\n"<BR>
<strong>Context:</strong>  &lt;passwd&gt;
<p>
    Password Unchanged
</p>
<h2><a name="error_tooshort">error_tooshort</a></h2>
<strong>Syntax:</strong>   error_tooshort   <em>filename</em> <b>OR</b>
error_tooshort   Redirect <em>location</em><BR>
<strong>Default:</strong>  "Password too short...\n"<BR>
<strong>Context:</strong>  &lt;passwd&gt;
<p>    
    the password length is below <a href="#min_length">min_length</a>
</p>       
<h2><a name="error_torlong">error_toolong</a></h2>
<strong>Syntax:</strong>   error_toolong    <em>filename</em> <b>OR</b>
error_toolong  Redirect <em>location</em><br>
<strong>Default:</strong>  "Password too long...\n"<BR>
<strong>Context:</strong>  &lt;passwd&gt;<BR>
<p>    
    the password length is above <a href="#max_length">max_length</a>
</p>
<h2><a name="error_locked">error_locked</a></h2>
<strong>Syntax:</strong> error_locked<em>filename</em> <b>OR</b>
error_locked  Redirect <em>location</em><BR>
<strong>Default:</strong> "Maximum number of tries exceeded...\n"<br>
<strong>Context:</strong>  &lt;passwd&gt;, &lt;mailcfg&gt;
<p>    
    The user has exceeded the <a href="#max_invalid">max_invalid</a>
    tries
</p>    
<h2><a name="error_forwardto">error_forwardto</a></h2>
<strong>Syntax:</strong> error_forwardto	<em>filename</em> <b>OR</b>
error_forwardto	 Redirect <em>location</em><br>
<strong>Default:</strong>"Forward to who???"<br>
<strong>Context:</strong>  &lt;mailcfg&gt;
<p>    
    The user has enabled mail forwarding, but didn't supply a forward to mail
    address
</p>       
<h2><a name="error_invalidforwardto">error_invalidforwardto</a></h2>
<strong>Syntax:</strong>  error_invalidforwardto <em>filename</em>
 <b>OR</b> error_invalidforwardto <em> Redirect location</em><br>
<strong>Default:</strong> not set<br>	     
<strong>Context:</strong> &lt;mailcfg&gt;<br>
<p>
    The forward to email address is invalid
</p>    
<h2><a name="msg_success">msg_success</a></h2>
<strong>Syntax:</strong> msg_success <em>filename</em> <b>OR</b>
msg_success Redirect <em>location</em><br>
<strong>Default:</strong> not set<br>	     
<strong>Context:</strong>  &lt;passwd&gt;, &lt;mailcfg&gt;<BR>
<p>    
    The password or mail configuration is updated successfully
</p>     
<h2><a name="msg_changed">msg_changed</a></h2>
<strong>Syntax:</strong> msg_changed <em>filename</em> <b>OR</b>
msg_changed  Redirect <em>location</em><br>
<strong>Default:</strong> not set<br>	     
<strong>Context:</strong>  &lt;passwd&gt;, &lt;mailcfg&gt;
<p>    
    see <a href="#msg_success">msg_success</a>
</p>
<h2><a name="msgmsg_updated">msg_updated</a></h2>
<strong>Syntax:</strong> msg_updated  <em>filename</em> <b>OR</b>
msg_updated  Redirect <em>location</em><br>
<strong>Default:</strong> not set<br>	     
<strong>Context:</strong> &lt;passwd&gt;, &lt;mailcfg&gt;
<p>    
    see <a href="#msg_success">msg_success</a>
</p>
<h2><a name="error_read">error_readname</a></h2>
<strong>Syntax:</strong> error_readname <em>filename</em> <b>OR</b>
error_readname   Redirect   <em>location</em><br>
<strong>Default:</strong> "[CGIpaf] Can't read loginname\n"<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>       
    mailcfg.cgi is unable to read to username, this is probably an error in 
    <a href="#mailcfg_document">mailcfg_document</a>.
</p>
<h2><a name="error_readforward">error_readforward</a></h2>
<strong>Syntax:</strong> error_readforward  <em>filename</em> <b>OR</b>
error_readforward   Redirect   <em>location</em><br>
<strong>Default:</strong> "[CGIpaf] Can't read forward\n"<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>       
    mailcfg.cgi is unable to read forward, this is probably an error in 
    <a href="#mailcfg_document">mailcfg_document</a>.
</p>
<h2><a name="error_readkeepmsg">error_readkeepmsg</a></h2>
<strong>Syntax:</strong> error_readkeepmsg  <em>filename</em> <b>OR</b>
error_readkeepmsg   Redirect   <em>location</em><br>
<strong>Default:</strong> "[CGIpaf] Can't read keepmsg\n"<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>       
    mailcfg.cgi is unable to read keep_msg, this is probably an error in 
    <a href="#mailcfg_document">mailcfg_document</a>.
</p>     
<h2><a name="error_readautoreply">error_readautoreply</a></h2>
<strong>Syntax:</strong> error_readautoreply   <em>filename</em>
<b>OR</b>error_readautoreply   Redirect   <em>location</em><br>
<strong>Default:</strong> "[CGIpaf] Can't read autoreply\n"<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>       
    mailcfg.cgi is unable to read autoreply, this is probably an error in 
    <a href="mailcfg_document">mailcfg_document</a>.
</p>
<h2><a name="error_autoreply_msg">error_autoreply_msg</a></h2>
<strong>Syntax:</strong> error_autoreplymsg   <em>filename</em> <b>OR</b>
error_autoreplymsg   Redirect   <em>location</em><br>
<strong>Default:</strong> "Can't read autoreply_msg...\n"<br>
<strong>Context:</strong> &lt;mailcfg&gt;<br>
<p>       
    The user has enabled autoreply, but didn't supply a autoreply message.
</p>       
<h2><a name="error_cookie">error_cookie</a></h2>
<strong>Syntax:</strong> error_cookie  <em>filename</em> <b>OR</B>
error_cookie   Redirect  <em>location</em><br>
<strong>Default:</strong> "To update your mail configuration your browser need to
support cookies...\n"<br>
<strong>Context:</strong> &lt;mailcfg&gt;<br>
<p>       
    mailcfg.cgi can't update the mail configuration without cookies.
</p>       
<h2><a name="error_cookietimeout">error_cookietimeout</a></h2>
<strong>Syntax:</strong> error_cookietimeout  <em>filename</em>
<b>OR</B> error_cookietimeout Redirect <em>location</em><br>
<strong>Default:</strong> "Cookie timeout exceeded...\n"<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>       
    mailcfg.cgi can't update the mail configuration because the cookie is too 
    old.
</p>
<h2><a name="error_accessdb">error_accessdb</a></h2>
<strong>Syntax:</strong> error_accessdb  <em>filename</em> <b>OR</b>
error_accessdb  Redirect    <em>location</em><br>
<strong>Default:</strong> "[CGIpaf] configuration error, (view)mailcfg needs a
accessdb.\n Please contact the webmaster"<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>
    (view)mailcfg.cgi can't work without an 
    <a href="#accessdb">accessdb</a>
</p>
<h2><a name="error_cracklib">error_cracklib</a></h2>
<strong>Syntax:</strong> error_cracklib  <em>filename</em> <b>OR</b>
error_cracklib  Redirect    <em>location</em><br>
<strong>Default:</strong> "BAD PASSWORD, %{cracklib_error}<br>
<strong>Context:</strong> &lt;passwd&gt;
<p>
    cracklib error
</p>
<h2><a name="error_mailcfgscript">error_mailcfgscript</a></h2>
<strong>Syntax:</strong> error_mailcfgscript  <em>filename</em> <b>OR</b>
error_mailcfgscript  Redirect    <em>location</em><br>
<strong>Default:</strong> "run_mailcfg returns a non-null value, %{mailcfg_exitcode}<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>
    <a href="#run_mailcfg">run_mailcfg</a> failed. 
</p>
<h2><a name="error_pam">error_pam</a></h2>
<strong>Syntax:</strong> error_pam  <em>filename</em> <b>OR</b>
error_pam  Redirect    <em>location</em><br>
<strong>Default:</strong> "Can't update password, errno, %{pam_error}<br>
<strong>Context:</strong> &lt;passwd&gt;
<p>
    pam error
</p>
<h2><a name="error_illegalword">error_illegalword</a></h2>
<strong>Syntax:</strong> error_illegalword <em>filename</em> <b>OR</b>
error_illegalword  Redirect    <em>location</em><br>
<strong>Default:</strong> bad password
<strong>Context:</strong> &lt;passwd&gt;
<p>
    The new password contains an illegal word.
</p>
<h2><a name="min_uid">min_uid</a></h2>
<strong>Syntax:</strong> min_uid <em>uid</em><br>
<strong>Default:</strong> 100<br>
<strong>Context:</strong> global, &lt;passwd&gt;, &lt;mailcfg&gt;<br>
<p>       
     minimum user id, if a uid is bellow min_uid access will be denied. You 
     can't set min_uid lower then 10.
</p>     
<h2><a name="max_uid">max_uid</a></h2>
<strong>Syntax:</strong> max_uid <em>uid</em><br>
<strong>Default:</strong> not set<br>
<strong>Context:</strong> Global, &lt;passwd&gt;, &lt;mailcfg&gt;
<p>       
     maximum user id, if the uid is higher than max_uid access will be denied. 
     If max_uid isn't set there is no maximum.
</p>       
<h2><a name="min_length">min_length</a></h2>
<strong>Syntax:</strong> min_length <em>length</em><BR>
<strong>Default:</strong> 6<br>
<strong>Context:</strong> &lt;passwd&gt;<br>
<p>       
     minimum password length
</p>       
<h2><a name="max_length">max_length</a></h2>
<strong>Syntax:</strong> max_length <em>length</em><br>
<strong>Default:</strong> 8<br>
<strong>Context:</strong> &lt;passwd&gt;
<p>       
     maximum password length
</p>     
<h2><a name="accessdb">accessdb</a></h2>
<strong>Syntax:</strong> accessdb  <em>path</em><br>
<strong>Default:</strong> not set<br>
<strong>Context:</strong> global, &lt;passwd&gt;, &lt;mailcfg&gt;
<p>       
     accessdb path, if not set no access database is used. If not set Users 
     can try to change their password as many times they like.
     (view)mailcfg.cgi don't work without an accessdb. 
</p>
<h2><a name="cracklib">cracklib</a></h2>
<strong>Syntax:</strong> cracklib <em>on|off</em><br>
<strong>Default:</strong> off<br>
<strong>Context:</strong> &lt;passwd&gt;
<p>       
     enable cracklib test, the new password is tested with cracklib.
     if the password is invalid <a href="#error_cracklib">error_cracklib</a>
     is displayed.
</p>
<p>
     you have to set the <a href="#cracklib_dictpath">cracklib_dictpath</a> 
     directive to your cracklib dictpath otherwise cracklib is disabled.
</p>
<p>
  CGIpaf support cracklib password testing in the PAM configuration, if cracklib is enabled in 
  your PAM configuration and you should set cracklib to off.
</p>
<h2><a name="cracklib_dictpath">cracklib_dictpath</a></h2>
<strong>Syntax:</strong> cracklib_dictpath  <em>/path/to/cracklib_dict</em><br>
<strong>Default:</strong> off<br>
<strong>Context:</strong> &lt;passwd&gt;
<p>
   Set the cracklib_dictpath, the cracklib_dictpath should be set to the 
   dictionary filename without the extension ( .pwi ), not the directory path.
</p>
<h2><a name="vmail_support">vmail_support</a></h2>
<strong>Syntax:</strong> vmail_support  <em>yes|no</em><br>
<strong>Default:</strong> off<br>
<strong>Context:</strong> global, &lt;passwd&gt;, &lt;mailcfg&gt;
<p>
   Enable support for Linuxconf virtual email domains passwords<br>
   This directive is only available if you've compiled CGIpaf without
   PAM support and isn't supported on *BSD systems.
</p>
<h2><a name="passwd_location">passwd_location</a></h2>
<strong>Syntax:</strong> passwd_location  <em>/path/to/your/passwd_file</em><br>
<strong>Default:</strong> system passwd<br>
<strong>Context:</strong> global, &lt;passwd&gt;, &lt;mailcfg&gt;
<p>
   Set the password file location. This directive is only available if you've
   compiled CGIpaf without PAM support and isn't supported on *BSD systems.
</p>
<h2><a name="shadow_location">shadow_location</a></h2>
<strong>Syntax:</strong> passwd_location  <em>/path/to/your/shadow_file</em><br>
<strong>Default:</strong> system shadow<br>
<strong>Context:</strong> global, &lt;passwd&gt;, &lt;mailcfg&gt;
<p>
   Set the shadow file location. This directive is only available if you've
   compiled CGIpaf without PAM support and isn't supported on *BSD systems.
</p>
<h2><a name="illegal_words">illegal_words</a></h2>
<strong>Syntax:</strong> illegal_words <em>word1 word2</em><br>
<strong>Default:</strong> not set<br>
<strong>Context:</strong> &t;passwd&lt;
<p>
   Specify a list of words that are illegal to use as a part of a new password
</p>
<h2><a name="set_pam_change_expired_authtok">set_PAM_CHANGE_EXPIRED_AUTHTOK</a></h2>
<strong>Syntax:</strong> set_PAM_CHANGE_EXPIRED_AUTHTOK <em>on</em>|<em>off</em><br>
<strong>Default:</strong> on<br>
<strong>Context:</strong> &lt;passwd&gt;
<p>
     Set the PAM_CHANGE_EXPIRED_AUTHTOK flag.<br>
     <strong>This directive is obsolete and will be removed in the next Releases of CGIpaf</strong>
</p>
<h2><a name="max_invalid">max_invalid</a></h2>
<strong>Syntax:</strong> max_invalid  <em>tries</em><br>
<strong>Default:</strong>  3<br>
<strong>Context:</strong> global, &lt;passwd&gt;, &lt;mailcfg&gt;
<p>       
     maximum invalid tries, if not set the default value (3) will be used.
</p>
<h2><a name="invalid_timeout">invalid_timeout</a></h2>
<strong>Syntax:</strong> invalid_timeout <em>seconds</em>
<strong>Default:</strong>  600<br>
<strong>Context:</strong>  global, &lt;passwd&gt;, &lt;mailcfg&gt;<Br>
<p>       
     time in seconds that a user will be locked out if the max_invalid tries 
     has been exceeded.
</p>       
<h2><a name="sendmail">sendmail</a></h2>
<strong>Syntax:</strong> sendmail  <em>path_to_sendmail</em><br>
<strong>Default:</strong> "/usr/lib/sendmail"<br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>       
     mailcfg.cgi uses the path_to_sendmail in ~/.procmailrc, if your mailer is 
     on another location location than "/usr/lib/sendmail" you've to set the 
     sendmail directive.
</p>       
<h2><a name="domain">domain</a></h2>
<strong>Syntax:</strong> domain <em>domain_name</em><br>
<strong>Default:</strong> nisdomain or domain name in
/etc/resolv.conf<br>
<strong>Context:</strong>  &lt;mailcfg&gt;
<p>       
     A "X-loop: user@domainname" header is added to the forwarded or the
     replied mail to avoid mail looping. With the domain directive you can set 
     the domainname in the "X-loop" header. If domain is not set mailcfg.cgi 
     will use hostname.nisadomainname, if your server isn't part of a NIS 
     domain it'll use the domain in /etc/resolv.conf.
</p>       
<h2><a name="use_statefile">use_statefile</a></h2>
<strong>Syntax:</strong> use_statefile <em>yes|no</em>
<strong>Default</strong> no<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>
     CGIpaf creates a state file ( $HOME/.cgipaf_state ) in the user's home directory.
     This file contains the user's current mail configuration state. This file is used by
     <a href="#run_before_mailcfg">run_before_mailcfg</a>, <a href="#run_after_mailcfg">run_after_mailcfg</a> and <a href="#run_mailcfg">run_mailcfg</a>.
     <br>
     By default viewmailcfg.cgi doesn't use this file ( mainly for compatibility reasons ),
     but reads the user's .procmailrc to determine the user mail configuration.
     If you set "use_statefile" to "yes" viewmailcfg.cgi will read the state file instead
     of the user's .procmailrc to get the user's current mail configuration.
     <br>
     If your user's uses their own .procmailrc to distribute their mailinglists into separated
     mailboxes you must set "use_statefile" to "yes". The user's original .procmailrc
     could confuse CGIpaf.
</p>
<h2><a name="run_mailcfg">run_mailcfg</a></h2>
<strong>Syntax:</strong> run_mailcfg   <em>path_to_script</em>
<strong>Default:</strong> built-in procmailrc update<br>
<strong>Run as:</strong> user<br>
<strong>Context:</strong> &lt;mailcfg&gt;
<p>
     define a mail configuration script, if not set the built-in procmail
     configuration updater is used<br>
     if set, <a href="#use_statefile">use_statefile</a> is enabled.
</p>
<h2><a name="run_success">run_success</a></h2>
<strong>Syntax:</strong> run_success   <em>path_to_script</em>
<em>stdout</em><br>
<strong>Default:</strong> not set<br>
<strong>Run as:</strong>   root<br>
<strong>Context:</strong> &lt;passwd&gt;, &lt;mailcfg&gt;
<p>       
     runs a script is a password / mail configuration is successfully
     updated. Example:
</p>
<pre><tt><code>
     run_success "/usr/sbin/smbpasswd -U %{name} &gt; /dev/null 2&gt;&amp;1" "%{password}\n%{password}\n"
</code></tt></pre>
<p>
     Will update the SAMBA password file.
</p> 
<h2><a name="run_locked">run_locked</a></h2>
<strong>Syntax:</strong>   run_locked    <em>path_to_script</em>
<em>stdout</em>
<strong>Default:</strong> not set<br>
<strong>Run as:</strong>   root<br>
<strong>Context:</strong>  &lt;passwd&gt;,  &lt;mailcfg&gt;<br>
<p>	
     run a script is a user is locked.
</p>
<h2><a name="run_before_mailcfg">run_before_mailcfg</a></h2>
<strong>Syntax:</strong>   run_before_mailcfg  <em>script</em>
<strong>Default:</strong>   not set<br>
<strong>Run as:</strong>     <em>mail user</em><br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>
     run a script before the mail configuration. mailcfg.cgi will 
     execute the "run_before_mailcfg" script if the mail configuration state 
     goes from not active ( no mail forwarding and no autoreply ) to active.
<br>
     This can be used to copy the user's .procmailrc to a backup file. 
<p>
<h2><a name="run_after_mailcfg">run_after_mailcfg</a></h2>
<strong>Syntax:</strong>   run_after_mailcfg   <em>script</em>
<strong>Default:</strong>   not set<br>
<strong>Context:</strong>   &lt;mailcfg&gt;<br>
<p>
     run a script after the mail configuration. mailcfg.cgi will
     execute the "run_after_mailcfg" script if the mail configuration state 
     goes from active ( mail forwarding or autoreply enabled ) to nonactive.
<br>
     This script can be used to restore the user's .procmailrc to his original
     state
</p>        
<h2><a name="cookie_timeout">cookie_timeout</a></h2>
<strong>Syntax:</strong>   cookie_timeout    <em>seconds</em>
<strong>Default:</strong> 300<br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>	
     cookie life time in seconds.
</p>        
<h2><a name="mailcfg_document">mailcfg_document</a></h2>
<strong>Syntax:</strong>   mailcfg_document <em>filename</em>  <b>OR</b>
mailcfg_document Redirect <em>Location</em><br>
<strong>Default:</strong> builtin message<br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>	
     Path to the mail configuration document
</p>        
<h2><a name="error_deldotforward">error_deldotforward</a></h2>
<strong>Syntax:</strong>   error_deldotforward <em>filename</em>  <b>OR</b>
error_deldotforward Redirect <em>Location</em><br>
<strong>Default:</strong> "Can't delete ~/.forward please contact the
webmaster"<br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>	
     Unable to delete .forward
</p>        
<h2><a name="error_deldotprocmailrc">error_deldotprocmailrc</a></h2>
<strong>Syntax:</strong>   error_deldotprocmailrc <em>filename</em>  <b>OR</b>
error_deldotprocmailrc Redirect <em>Location</em><br>
<strong>Default:</strong> "Can't delete ~/.procmailrc please contact the
webmaster"<br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>	
     Unable to delete .forward
</p>        
<h2><a name="error_openvacations">error_openvacations</a></h2>
<strong>Syntax:</strong>   error_openvacations <em>filename</em>  <b>OR</b>
error_openvacations Redirect <em>Location</em><br>
<strong>Default:</strong> "Can't open ~/.vacations.txt please contact the
webmaster"<br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>	
     Unable to open ~/vacations.txt
</p>
<h2><a name="error_updateprocmailrc">error_updateprocmailrc</a></h2>
<strong>Syntax:</strong>   error_updateprocmailrc <em>filename</em>  <b>OR</b>
error_updateprocmailrc Redirect <em>Location</em><br>
<strong>Default:</strong> "Can't update ~/.procmailrc, please contact the webmaster"
webmaster"<br>
<strong>Context:</strong>  &lt;mailcfg&gt;<br>
<p>	
     Unable to update ~/.procmailrc
</p>

<h2><a name="aclorder">AclOrder</a></h2>
<strong>Syntax:</strong>   AclOrder  <em>Deny,All</em>  <b>OR</b> <em>Allow,Deny</em><br>
<strong>Default:</strong>   Deny,Allow<br>
<strong>Context:</strong>  Global,&lt;passwd&gt;,&lt;mailcfg&gt;
<p>
Set the <a href="#acl">Acl</a> order.
</p>
<h2><a name="allowusers">AllowUsers</a></h2>
<strong>Syntax:</strong>   AllowUsers  <em>user1 user2</em>  <b>OR</b> <em>*</em><br>
<strong>Default:</strong>  see <a href="#acl">Access Control List</a><br>
<strong>Context:</strong>  Global,&lt;passwd&gt;,&lt;mailcfg&gt;
<p>
Specify a list of users that are allowed to use CGIpaf see <a href="#acl">Access Control List</a>
</p>
<h2><a name="denyusers">DenyUsers</a></h2>
<strong>Syntax:</strong>   DenyUsers  <em>user1 user2</em>  <b>OR</b> <em>*</em><br>
<strong>Default:</strong>  see <a href="#acl">Access Control List</a><br>
<strong>Context:</strong>  Global,&lt;passwd&gt;,&lt;mailcfg&gt;
<p>
Specify a list of users that are denied to use CGIpaf see <a href="#acl">acl</a>
</p>
<h2><a name="allowgroups">AllowGroups</a></h2>
<strong>Syntax:</strong>   AllowGroups  <em>group1 group2</em>  <b>OR</b> <em>*</em><br>
<strong>Default:</strong>  see <a href="#acl">Access Control List</a><br>
<strong>Context:</strong>  Global,&lt;passwd&gt;,&lt;mailcfg&gt;
<p>
Specify a list of groups that are allowed to use CGIpaf see <a href="#acl">acl</a>
</p>
<h2><a name="denygroups">DenyGroups</a></h2>
<strong>Syntax:</strong>   DenyGroups  <em>group1 group2</em>  <b>OR</b> <em>*</em><br>
<strong>Default:</strong>  see <a href="#acl">Access Control List</a><br>
<strong>Context:</strong>  Global,&lt;passwd&gt;,&lt;mailcfg&gt;
<p>
Specify a list of groups that are denied to use CGIpaf see <a href="#acl">acl</a>
</p>

<h1><a name="variables">Variables</a></h1>
<p>
    For each document you can as use a 
    <a href="#htmlfile">plain html file</a> with a few PHP
    extensions (see bellow) or a <a href="#redirect">redirect</a>. 
    In a redirect, file or 
    <a href="#run_success">run_success</a> and 
    <a href="#run_locked">run_locked</a> you can use the following variables: 
</p>
<table>
<tr><td><b>Variable name</b></td><td><b>Description</b></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td><b>name</b></td><td>loginname</td></tr>
<tr><td><b>min_length</b></td><td>minimum password length</td></tr>
<tr><td><b>max_length</b></td><td>maximum password length</td></tr>
<tr><td><b>max_invalid</b></td><td>maximum invalid tries</td></tr>
<tr><td><b>invalid_timeout</b></td><td>time in seconds that a user
will be locked out if the max_invalid tries has been exceeded.</td></tr>
<tr><td><b>invalid_wait</b></td><td>a locked user will have to wait
invalid_wait seconds</td></tr>
<tr><td><b>forward_to</b></td><td>the email where the mails will
forward to</td></tr>
<tr><td><b>forward</b></td><td>if mail forwarding is enabled $forward is set 
to "yes". if mail forwarding is disabled $forward is "no"</td></tr>
<tr><td><b>not_forward</b></td><td>not_forward is the reverse of forward, so 
if $forward is "yes" $not_forward is "no"</td></tr>
<tr><td><b>keep_msg</b></td><td>$keep_msg is set to "yes" if the use 
want to keep his forwarded mails, set to "no" otherwise</td></tr>
<tr><td><b>not_keep_msg</b></td><td>the reverse of $keep_msg</td></tr>
<tr><td><b>autoreply</b></td><td>is "yes" if the use has enabled
autoreply</td></tr>
<tr><td><b>not_autoreply</b></td><td>reverse of $autoreply</td></tr>
<tr><td><b>autoreply_msg</b></td><td>the autoreply message</td></tr>
<tr><td><b>cookietimeout</b></td><td>cookie lifetime is
seconds</td></tr>
<tr><td><b>cracklib_error</b></td><td>cracklib error message</td></tr>
<tr><td><b>bad_password</b></td><td>The new password contains a illegal word, is set to cracklib_error if there is cracklib error</td></tr>
<tr><td><b>pam_error</b></td><td>pam error message</td></tr>
<tr><td><b>password</b></td><td>the user's new password, is only set at
<a href="#run_success">run_success</a></td></tr>
<tr><td><b>mailcfg_exitcode</b></td><td>exitcode of the <a href="#run_mailcfg">
run_mailcfg script</a></td></tr>
<tr><td><b>homedir</b></td><td>the user's home directory</td></tr>
<tr><td><b>domain</b></td><td>the <a href="#domain">domain</a>name, only set by mailcfg.cgi</td></tr>
<tr><td><b>user_maildomain</b></td><td>The user maildomain ( only available if <a href="#vmail_support">vmail support</a> is enabled</td>
</table>
<h1><a name="redirect">Redirect</a></h1>
<p> 
example:
</p>
<pre><code><tt>      
       msg_success   redirect  /pwchanged.php?name="%{name}"
</tt></code></pre>
<p>
    Will redirect to /pwchanged.php?name="loginname" after a user has succeed
    to change his password.
</p>
<h1><a name="htmlfile">HTML files</a></h1>
<p>
    If you don't use a redirect you can use plain html files with two PHP 
    extensions "include" and "echo". The same variables as by a redirect are 
    available.
</p>
<pre><code><tt>
      &lt;? echo $name; include "bottom.php" ?&gt;
</tt></code></pre>
<p>
    Will print the user's name and include bottom.php. Please note that the
    PHP implementation is very limited. include("bottom.php") won't work for
    example.
</p>
<h1><a name="command">run_success and run_locked scripts</a></h1>
<p>
   With <a href="#run_success">run_success</a> and <a href="#run_locked">
   run_locked</a> it's possible to run a script when a has update his 
   password/mail configuration or when a user is locked out.
</p>
<p>
   The first argument is the script name, the second argument is send to 
   stdout. The second argument is usually used to pass the new password to
   a script.
</p>
<p>
  Example:
  <pre><tt><code>
  run_success "/usr/sbin/smbpasswd -U %{name} &gt; /dev/null 2&gt;&amp;1" "%{password}\n%{password}\n"
  </code></tt></pre>
<h1><a name="acl">Access Control List</a></h1>
<p>
    With the Access Control list you can allow or deny users or groups. 
</p>
<p> 
The <a href="#aclorder">AclOrder</a> directive control the default access state and the order in which the acl is processed.
</p>
<dl>
  <dt>Allow,Deny</dt>

  <dd>The <a href="#allowusers">AllowUsers</a> and <a href="#allowgroups">AllowGroups</a> directives are evaluated before the <a href="#denyusers">DenyUsers</a> and <a href="#denygroups">DenyGroups</a> directives. Access is denied by default.</dd>

  <dt>Deny,Allow</dt>


  <dd>The <a href="#denyusers">DenyUsers</a> and <a href="#denygroups">DenyGroups</a> directives are evaluated before the <a href="#allowusers">AllowUsers</a> and <a href="#allowgroups">AllowGroups></a>. Access is granted by default.</dd>
</dl>
<p>
A star (*) in the user or group list means any user or group other wildcards are not supported.
</p>
<p>
<h2><a name="aclexamples">Examples</a></h2>
<pre><code>
AclOrder     Deny,Allow
DenyUsers    *
AllowUsers   foo
</code></pre>
<p>
Access to user "foo" will be allowed and all other will be denied.   
</p>
<pre><code>
AclOrder     Allow,Deny
AllowUsers   foo
</code></pre>
<p>
Give the same result as above.
</p>
<pre><code>
AclOrder Allow,Deny
</code></pre>
<p>
Will denied access to all, because the default state is set to deny.

</body>
</html>
