#!/bin/sh
# cgipaf install script			        staf wagemakers
#                                               staf@wagemakers.be
#                                               http://www.wagemakers.be
read_yesno () {
read INPUT
  case "$INPUT" in
         "yes")
                 YESNO=1
                 ;;
         "y")
                 YESNO=1
                 ;;
         *)
                 YESNO=0
                 ;;
   esac
return $YESNO
}

prefix="@prefix@"
exec_prefix="@exec_prefix@"
exec_suffix="@exec_suffix@"
cgi_suffix="@cgi_suffix@"
top_srcdir="@top_srcdir@"
bindir="@bindir@"
libexecdir="@libexecdir@"
sysconfdir="@sysconfdir@"
localstatedir="@localstatedir@"
srcdir="@srcdir@"
datadir="@datadir@"


if [ ! -x ./passwd.cgi ]; then
   echo "type make to compile cgipaf"
   exit 1
fi
CFGFILE="${sysconfdir}/cgipaf.conf"
CGIBIN="${bindir}"

rootgroup="root"

uname | grep -i bsd > /dev/null
if [ "$?" = "0" ]
   then
         rootgroup="wheel"
fi

if [ ! -d $CGIBIN ]
   then

   echo "$CGIBIN doesn't exist...."
   echo "Create $CGIBIN? (yes/no)"
   read_yesno
   
   if [ "$YESNO" = "1" ]
      then
           mkdir -p $CGIBIN
      fi

fi

if [ -d $CGIBIN ] 
   then
         mkdir -p @sysconfdir@
         cp -i passwd.cgi viewmailcfg.cgi mailcfg.cgi $CGIBIN
         chown root:$rootgroup $CGIBIN/passwd.cgi $CGIBIN/viewmailcfg.cgi $CGIBIN/mailcfg.cgi
         chmod 4555 $CGIBIN/passwd.cgi $CGIBIN/viewmailcfg.cgi $CGIBIN/mailcfg.cgi
   else
         echo "$CGIBIN doesn't exist...."
	 echo "Can't copy binary files!!!!"
	 sleep 5
fi

WWW="${datadir}"
if [ -d $WWW ]
      then
         cp -i php/*.php $WWW
         chmod 644 $WWW/cgipasswd*.php $WWW/mailcfg*.php $WWW/viewmailcfg*.php 
      else
         echo "$WWW doesn't exist...."
	 echo "Create $WWW? (yes/no)"
	 read_yesno
	 if [ "$YESNO" = "1" ]
	    then
	      mkdir -p $WWW
              cp -i php/*.php $WWW
              chmod 644 $WWW/cgipasswd*.php $WWW/mailcfg*.php $WWW/viewmailcfg*.php 
	 else
	    echo "Couldn't copy standard php files"
	    sleep 5
	 fi		   
fi
   if [ -f $CFGFILE ]
      then
        echo "$CFGFILE already exists. Overwrite? (yes/no)"
	read_yesno
      else
        YESNO=1
   fi
   if [ "$YESNO" = "1" ]; then
   sh ./createconfig.sh
   cp ./cgipaf.conf $CFGFILE
   chmod 644 $CFGFILE
 
   fi
   
echo "Thank you for using cgipaf!"
echo "Goodbye....."
